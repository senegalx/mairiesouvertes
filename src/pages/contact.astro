---
import Base from "@/layouts/Base.astro";
import PageHeader from "@/partials/PageHeader.astro";
import type { CollectionKey } from "astro:content";
import { getEntry } from "astro:content";

const entry = await getEntry("pages" as CollectionKey, "contact");
const { title, description, meta_title, image, supports } = entry.data;
---

<Base
  title={title}
  meta_title={meta_title}
  description={description}
  image={image}
>
  <PageHeader title={title} />

  <section
    class="section-md relative mt-[-28rem] overflow-hidden md:mt-[-32rem]"
  >
    <div class="container relative z-30">
      <div class="row relative">
        <div class="mx-auto md:col-10">
          <div
            data-aos="fade-up-sm"
            class="shadow-default rounded-2xl bg-white px-8 py-10 sm:px-16 sm:py-14"
          >
            <form method="POST" action="/" data-netlify-recaptcha="true" data-netlify="true" name="contact" class="row gy-4 text-dark">
              <div class="sm:col-6">
                <label for="prenom" class="form-label">Prénom</label>
                <input
                  type="text"
                  class="form-input"
                  placeholder="Votre prénom"
                  id="prenom"
                  name="prenom"
                  required
                />
              </div>
              <div class="sm:col-6">
                <label for="nom" class="form-label">Nom</label>
                <input
                  type="text"
                  class="form-input"
                  placeholder="Votre nom"
                  id="nom"
                  name="nom"
                  required
                />
              </div>
              <div class="col-12">
                <label for="email" class="form-label">Email</label>
                <input
                  type="email"
                  class="form-input"
                  placeholder="Adresse E-mail"
                  id="email"
                  required
                  name="email"
                />
              </div>
              <div class="col-12">
                <label for="raison" class="form-label">Raison/But</label>
                <select
                  id="raison"
                  required
                  name="raison"
                  class="w-full rounded-lg border-border px-5 py-4 text-sm"
                >
                  <option value="Poser une question">Poser une question</option>
                  <option value="Suggérer une amélioration">Suggérer une amélioration</option>
                  <option value="Devenir volontaire">Devenir volontaire</option>
                  <option value="Devenir partenaire">Devenir partenaire</option>
                </select>
              </div>
              <div class="col-12">
                <label for="message" class="form-label">Message</label>
                <textarea
                  name="message"
                  class="form-textarea"
                  placeholder="Votre Message"
                  id="message"
                  cols="30"
                  required
                  rows="4"></textarea>
              </div>
              <div class="col-12 text-right">
                <button type="submit" class="btn btn-primary"> Envoyer </button>
              </div>
            </form>
          </div>
        </div>

        <!-- Start Bg Shape -->
        <div
          data-aos="fade-right-sm"
          class="pointer-events-none absolute bottom-[-8%] left-[5%] -z-10 hidden w-fit lg:block"
        >
          <img
            class="inject-svg text-quaternary"
            src="/images/shapes/contact-s-1.svg"
            alt="shape"
          />
        </div>
        <div
          data-aos="fade-left-sm"
          class="pointer-events-none absolute right-[4%] top-[35%] -z-10 hidden w-fit lg:block"
        >
          <img
            class="inject-svg text-tertiary"
            src="/images/shapes/contact-s-2.svg"
            alt="shape"
          />
        </div>
        <!-- End Bg Shape -->
      </div>
      <div
        class="row gy-4 pt-12 text-center md:justify-between md:pt-24 lg:justify-around"
      >
        {
          supports.map((support: any) => {
            return (
              <div data-aos="fade-up-sm" class="md:col-auto">
                <h2 class="sm:3xl mb-5 text-2xl font-semibold text-dark md:text-4xl">
                  {support.type}
                </h2>
                <p class="mb-2 text-lg sm:text-xl">
                  <a
                    class="hover:underline hover:underline-offset-2"
                    href="mailto:support@company.com"
                  >
                    {support.email}
                  </a>
                </p>
                <p class="text-lg sm:text-xl">
                  <a
                    class="hover:underline hover:underline-offset-2"
                    href="tel:+1 234 567 8999"
                  >
                    {support.mobile}
                  </a>
                </p>
              </div>
            );
          })
        }
      </div>
    </div>
  </section>
  <script>
    const form = document.querySelector('form[name="contact"]');
    form.addEventListener('submit', async (event) => {
      event.preventDefault();
      const formData = new FormData(form);
      formData.append('form-name', 'contact');
      try {
        const response = await fetch('/', {
          method: 'POST',
          headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
          body: new URLSearchParams(formData).toString(),
        });
        if (response.ok) {
          form.innerHTML = '<p>Merci pour votre message. Nous vous contacterons bientôt.</p>';
        } else {
          alert('Une erreur s\'est produite. Veuillez réessayer.');
        }
      } catch (error) {
        alert('Une erreur s\'est produite. Veuillez réessayer.');
      }
    });
  </script>
</Base>
